services:
  logseq_drawio:
    image: jgraph/drawio
    container_name: logseqdrawio
    restart: always
    networks:
      - traefik-public
    labels:
      - "traefik.enable=true"
      # New v3 routers with priority
      - "traefik.http.routers.drawio-v3.rule=Host(`drawio.fiks.im`)||Host(`drawio.k9.voronenko.net`)"
      - "traefik.http.routers.drawio-v3.ruleSyntax=v3"
      - "traefik.http.routers.drawio-v3.entrypoints=web"
      - "traefik.http.routers.drawio-v3.priority=100"

      # Existing v2 routers (kept as fallback)
      - "traefik.http.routers.drawio.rule=Host(`drawio.fiks.im`)||Host(`drawio.k9.voronenko.net`)"
      - "traefik.http.routers.drawio.entrypoints=web"

      # New v3 secure router
      - "traefik.http.routers.drawio_secure-v3.rule=Host(`drawio.fiks.im`)||Host(`drawio.k9.voronenko.net`)"
      - "traefik.http.routers.drawio_secure-v3.entrypoints=websecure"
      - "traefik.http.routers.drawio_secure-v3.tls=true"
      - "traefik.http.routers.drawio_secure-v3.ruleSyntax=v3"
      - "traefik.http.routers.drawio_secure-v3.priority=100"

      # Existing v2 secure router
      - "traefik.http.routers.drawio_secure.rule=Host(`drawio.fiks.im`)||Host(`drawio.k9.voronenko.net`)"
      - "traefik.http.routers.drawio_secure.entrypoints=websecure"
      - "traefik.http.routers.drawio_secure.tls=true"
      - "traefik.http.services.logseq_drawio.loadbalancer.server.port=8080"
  logseq_plantuml:
    image: plantuml/plantuml-server:tomcat
    container_name: logseqplantuml
    restart: always
    networks:
      - traefik-public
    labels:
      - "traefik.enable=true"
      # New v3 routers with priority
      - "traefik.http.routers.plantuml-v3.rule=Host(`plantuml.fiks.im`)||Host(`plantuml.k9.voronenko.net`)"
      - "traefik.http.routers.plantuml-v3.ruleSyntax=v3"
      - "traefik.http.routers.plantuml-v3.entrypoints=web"
      - "traefik.http.routers.plantuml-v3.priority=100"

      # Existing v2 routers (kept as fallback)
      - "traefik.http.routers.plantuml.rule=Host(`plantuml.fiks.im`)||Host(`plantuml.k9.voronenko.net`)"
      - "traefik.http.routers.plantuml.entrypoints=web"

      # New v3 secure router
      - "traefik.http.routers.plantuml_secure-v3.rule=Host(`plantuml.fiks.im`)||Host(`plantuml.k9.voronenko.net`)"
      - "traefik.http.routers.plantuml_secure-v3.entrypoints=websecure"
      - "traefik.http.routers.plantuml_secure-v3.tls=true"
      - "traefik.http.routers.plantuml_secure-v3.ruleSyntax=v3"
      - "traefik.http.routers.plantuml_secure-v3.priority=100"

      # Existing v2 secure router
      - "traefik.http.routers.plantuml_secure.rule=Host(`plantuml.fiks.im`)||Host(`plantuml.k9.voronenko.net`)"
      - "traefik.http.routers.plantuml_secure.entrypoints=websecure"
      - "traefik.http.routers.plantuml_secure.tls=true"
      - "traefik.http.services.logseq_plantuml.loadbalancer.server.port=8080"
  logseq_mermaid:
    image: softasap/mermaild-live-editor:latest
    container_name: logseqmermaid
    restart: always
    networks:
      - traefik-public
    labels:
      - "traefik.enable=true"
      # New v3 routers with priority
      - "traefik.http.routers.mm-v3.rule=Host(`mm.fiks.im`)||Host(`mm.k9.voronenko.net`)"
      - "traefik.http.routers.mm-v3.ruleSyntax=v3"
      - "traefik.http.routers.mm-v3.entrypoints=web"
      - "traefik.http.routers.mm-v3.priority=100"

      # Existing v2 routers (kept as fallback)
      - "traefik.http.routers.mm.rule=Host(`mm.fiks.im`)||Host(`mm.k9.voronenko.net`)"
      - "traefik.http.routers.mm.entrypoints=web"

      # New v3 secure router
      - "traefik.http.routers.mm_secure-v3.rule=Host(`mm.fiks.im`)||Host(`mm.k9.voronenko.net`)"
      - "traefik.http.routers.mm_secure-v3.entrypoints=websecure"
      - "traefik.http.routers.mm_secure-v3.tls=true"
      - "traefik.http.routers.mm_secure-v3.ruleSyntax=v3"
      - "traefik.http.routers.mm_secure-v3.priority=100"

      # Existing v2 secure router
      - "traefik.http.routers.mm_secure.rule=Host(`mm.fiks.im`)||Host(`mm.k9.voronenko.net`)"
      - "traefik.http.routers.mm_secure.entrypoints=websecure"
      - "traefik.http.routers.mm_secure.tls=true"
      - "traefik.http.services.logseq_mermaid.loadbalancer.server.port=8080"
networks:
  traefik-public:
    external: true
